---
# push workflow is shared and expected to perform actions after a merge happens
# on a maintenance branch (default or release). For example updating the
# draft release-notes.
name: push

on:
  workflow_call: # allows reuse of this workflow from other devtools repos

jobs:
  update_release_draft:
    runs-on: ubuntu-24.04
    steps:
      - uses: release-drafter/release-drafter@b1476f6e6eb133afa41ed8589daba6dc69b4d3f5 # v6
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

  notify:
    # if: always() && needs.update_release_draft.result == 'failure' && github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    needs:
      - update_release_draft
    steps:
      - name: Send CI failure notification
        if: secrets.DEVTOOLS_CI_SLACK_URL != ''
        run: |
          curl -X POST -H 'Content-type: application/json' \
          --data '{"text":"‚ùå Release/CI workflow failed on main branch for '${{ github.repository }}' (push.yml). Check logs: '${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}"}' \
          ${{ secrets.DEVTOOLS_CI_SLACK_URL }}
      - name: Skip notification (no webhook configured)
        if: secrets.DEVTOOLS_CI_SLACK_URL == ''
        run: echo "Skipping Slack notification - DEVTOOLS_CI_SLACK_URL secret not configured"
